var p=(o,E,m)=>new Promise((d,f)=>{var b=c=>{try{h(m.next(c))}catch(t){f(t)}},v=c=>{try{h(m.throw(c))}catch(t){f(t)}},h=c=>c.done?d(c.value):Promise.resolve(c.value).then(b,v);h((m=m.apply(o,E)).next())});import{u as me,R as ve,M as fe}from"./index.es-cKQJCCjf.mjs";import{g as ye}from"./ou-vTSdmTlV.mjs";import{r as L,S as _e,E as ge,e as he,M as ke}from"./bootstrap-OcJ_7BUG.mjs";import{_ as xe}from"./UserForm.vue_vue_type_script_setup_true_lang-CPdOdLYO.mjs";import{a6 as Ue,P as u,a7 as be,J as $,aF as s,aG as R,aH as G,aI as n,m as a,aa as i,ao as U,h as T,aX as Ce}from"../jse/index-index-CWuPeoDv.mjs";const V={Page:"/api/v1/system/user/page",Get:"/api/v1/system/user/get",PUT:"/api/v1/system/user",Delete:"/api/v1/system/user/del"};function De(o){return p(this,null,function*(){return L.post(V.Page,o)})}function Se(o){return p(this,null,function*(){return L.delete(V.Delete,{params:{id:o}})})}function Oe(o){return p(this,null,function*(){return L.put(V.PUT,o)})}function Ae(o){return p(this,null,function*(){return De(o)})}function Fe(o){return p(this,null,function*(){return Oe(o)})}function Ke(o){return p(this,null,function*(){return Se(o)})}const Ie=Ue({__name:"UserList",setup(o){const E={title:"text",key:"id",children:"nodes"},m=u([]),d=u([]),f=u([{text:"Expand to load",id:"",nodes:[]}]),b=u();be(()=>ye("").then(e=>{console.log("treeData",e),f.value=e,b.value=e[0],d.value.push(e[0].id),console.log("selected Key",v.value)}).catch(e=>{console.log("err",e)}));const v=u({}),h=[{title:"Id",dataIndex:"id",key:"id",sorter:!0,defaultSortOrder:"ascend"},{title:"Account",dataIndex:"account",key:"account",name:"account",sorter:!0,filtered:!0},{title:"displayname",dataIndex:"displayname",key:"displayname",sorter:!0,filtered:!0},{title:"Orgnization Unit",dataIndex:"ou",key:"ou",sorter:!0},{title:"Actions",key:"action"}],c=u(),t=u({Account:"",Displayname:""}),C=u("Id"),D=u("asc"),k=$(()=>{const e=[];return t.value.Account!==""&&e.push("account like ?"),t.value.Displayname!==""&&e.push("display_name like ?"),d.value.length>0&&e.push("ou_id = ?"),e}),S=$(()=>{const e=[];return t.value.Account!==""&&e.push(`%${t.value.Account}%`),t.value.Displayname!==""&&e.push(`%${t.value.Displayname}%`),d.value.length>0&&e.push(d.value[0]),e}),{data:B,run:O,refresh:H,loading:J,total:X,current:A,pageSize:F}=me(Ae,{defaultParams:{page:1,pageSize:10,sortField:"Id",sortOrder:"asc",filters:k,args:S},pagination:{currentKey:"page",pageSizeKey:"pageSize"}}),j={displayname:"display_name"},Q=$(()=>({total:X.value,current:A.value,pageSize:F.value})),M=()=>{setTimeout(()=>{H()},50)},W=(e,l)=>{v.value=l.node.dataRef,O({filters:k,args:S}),console.log("selected node",v.value)},Y=()=>{console.log("searchModel",t.value),setTimeout(()=>{O({page:A.value,pageSize:F.value,sortField:C.value,sortOrder:D.value,filters:k,args:S})},500)},Z=()=>{t.value={Account:"",Displayname:""},c.value.resetFields(),M()},y=u(!1),K=u(),P=u(),ee=e=>{K.value=e,y.value=!0},ae=e=>{ke.confirm({title:`Deleting Client ${e}`,content:`Are you sure delete this user ${e}?`,onOk(){Ke(e),M()},onCancel(){console.log("Cancel")}}),console.log("record",e)},te=()=>p(this,null,function*(){try{const e=yield P.value.validate();if(!e)return;console.log("form validate",e)}catch(e){console.log("error submit:",e);return}Fe(K.value),y.value=!1,M()}),ne=()=>{P.value.resetForm(),y.value=!1},oe=()=>{K.value={id:"",ou:v.value.text,ouid:v.value.id},y.value=!0},le=(e,l,_)=>{if(A.value=e.current,F.value=e.pageSize,_.field){const g=j[_.field];C.value=g!=null?g:_.field,D.value=_.order}else C.value="Id",D.value="asc";console.log("filter",k),O({page:A.value,pageSize:F.value,sortField:C.value,sortOrder:D.value,filters:k,args:S})};return(e,l)=>{const _=s("a-tree"),g=s("a-col"),se=s("a-page-header"),q=s("a-input"),w=s("a-form-item"),x=s("a-button"),I=s("a-divider"),re=s("a-form"),ue=s("a-space"),ce=s("a-checkbox"),ie=s("a-table"),de=s("a-modal"),pe=s("a-row");return R(),G(pe,{gutter:16,style:{height:"400px","margin-bottom":"5px"}},{default:n(()=>[a(g,{span:4},{default:n(()=>[a(_,{ref_key:"orgTree",ref:b,expandedKeys:m.value,"onUpdate:expandedKeys":l[0]||(l[0]=r=>m.value=r),selectedKeys:d.value,"onUpdate:selectedKeys":l[1]||(l[1]=r=>d.value=r),"field-names":E,"tree-data":f.value,style:{height:"400px","margin-bottom":"5px"},onSelect:W},null,8,["expandedKeys","selectedKeys","tree-data"])]),_:1}),a(g,{span:16},{default:n(()=>[a(se,{style:{border:"1px solid rgb(235 237 240)"},"sub-title":"User list page",title:"Users"}),a(re,{ref_key:"searchForm",ref:c,model:t.value,layout:"inline"},{default:n(()=>[a(w,{label:"Account"},{default:n(()=>[a(q,{value:t.value.Account,"onUpdate:value":l[2]||(l[2]=r=>t.value.Account=r),placeholder:"Account"},null,8,["value"])]),_:1}),a(w,{label:"Displayname"},{default:n(()=>[a(q,{value:t.value.Displayname,"onUpdate:value":l[3]||(l[3]=r=>t.value.Displayname=r),placeholder:"Displayname"},null,8,["value"])]),_:1}),a(w,null,{default:n(()=>[a(x,{type:"primary",onClick:Y},{icon:n(()=>[a(i(_e))]),default:n(()=>[U(" Search ")]),_:1}),a(x,{icon:T(i(ve)),type:"primary",onClick:Z},{default:n(()=>[U(" Reset ")]),_:1},8,["icon"]),a(I,{type:"vertical"}),a(x,{icon:T(i(fe)),type:"primary",onClick:oe},{default:n(()=>[U(" New ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),a(I,{type:"horizontal"}),a(ie,{columns:h,"data-source":i(B)?i(B).list:null,loading:i(J),pagination:Q.value,run:i(O),onChange:le},{bodyCell:n(({column:r,record:z})=>[r.key==="action"?(R(),G(ue,{key:0},{default:n(()=>[a(x,{icon:T(i(ge)),type:"primary",onClick:N=>ee(z)},{default:n(()=>[U(" Edit ")]),_:2},1032,["icon","onClick"]),a(I,{type:"vertical"}),a(x,{icon:T(i(he)),danger:"",onClick:N=>ae(z.id)},{default:n(()=>[U(" Delete ")]),_:2},1032,["icon","onClick"])]),_:2},1024)):r.key==="Enabled"?(R(),G(ce,{key:1,checked:z.Enabled,"onUpdate:checked":N=>z.Enabled=N},null,8,["checked","onUpdate:checked"])):Ce("",!0)]),_:1},8,["data-source","loading","pagination","run"]),a(de,{open:y.value,"onUpdate:open":l[4]||(l[4]=r=>y.value=r),title:"Edit User Info",onCancel:ne,onOk:te},{default:n(()=>[a(xe,{ref_key:"modalForm",ref:P,"form-model":K.value,"org-tree-data":f.value},null,8,["form-model","org-tree-data"])]),_:1},8,["open"])]),_:1})]),_:1})}}});export{Ie as default};
