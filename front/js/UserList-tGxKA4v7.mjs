var d=(o,$,f)=>new Promise((p,g)=>{var P=i=>{try{b(f.next(i))}catch(n){g(n)}},y=i=>{try{b(f.throw(i))}catch(n){g(n)}},b=i=>i.done?p(i.value):Promise.resolve(i.value).then(P,y);b((f=f.apply(o,$)).next())});import{u as he,R as Q,M as we}from"./index.es-BVwDNJs5.mjs";import{g as Ue}from"./ou-C578PGB7.mjs";import{r as C,S as xe,E as be,e as Se,M as De,f as Ce}from"./bootstrap-t35vpcz_.mjs";import{_ as Pe}from"./UserForm.vue_vue_type_script_setup_true_lang-BuxDTTKy.mjs";import{a6 as Oe,P as u,a7 as Ie,J as V,aF as s,aG as F,aH as K,aI as a,m as t,aa as c,ao as m,h as v,aX as Re,aW as Te}from"../jse/index-index-CqEm-tRS.mjs";const N={Page:"/api/v1/system/user/page",Get:"/api/v1/system/user/get",PUT:"/api/v1/system/user",Delete:"/api/v1/system/user/del",RESETPASSWORD:"/api/v1/system/user/resetpassword"};function Ae(o){return d(this,null,function*(){return C.post(N.Page,o)})}function ze(o){return d(this,null,function*(){return C.delete(N.Delete,{params:{id:o}})})}function Ee(o){return d(this,null,function*(){return C.put(N.PUT,o)})}function Fe(o){return d(this,null,function*(){return C.post(N.RESETPASSWORD,{username:o})})}const Ke={NewId:"/api/v1/system/utils/newid"};function Ne(){return d(this,null,function*(){return C.get(Ke.NewId)})}function $e(o){return d(this,null,function*(){return Ae(o)})}function Me(o){return d(this,null,function*(){return Ee(o)})}function Le(o){return d(this,null,function*(){return ze(o)})}function Ge(o){return d(this,null,function*(){return Fe(o)})}const Xe=Oe({__name:"UserList",setup(o){const $={title:"text",key:"id",children:"nodes"},f=u([]),p=u([]),g=u([{text:"Expand to load",id:"",nodes:[]}]),P=u(),y=u({});Ie(()=>Ue("").then(e=>{console.log("treeData",e),g.value=e,P.value=e[0],p.value.push(e[0].id),console.log("selected Key",y.value)}).catch(e=>{console.log("err",e)}));const b=[{title:"Id",dataIndex:"id",key:"id",sorter:!0,defaultSortOrder:"ascend"},{title:"Account",dataIndex:"account",key:"account",name:"account",sorter:!0,filtered:!0},{title:"Displayname",dataIndex:"displayname",key:"displayname",sorter:!0,filtered:!0},{title:"Email",dataIndex:"email",key:"email",sorter:!0,filtered:!0},{title:"Orgnization Unit",dataIndex:"ou",key:"ou",sorter:!0},{title:"Lock Out",dataIndex:"lockoutenabled",key:"lockoutenabled",sorter:!0},{title:"Temporary Password",dataIndex:"istemporarypassword",key:"istemporarypassword",sorter:!0},{title:"Actions",key:"action"}],i=u(),n=u({Account:"",Displayname:""}),O=u("Id"),I=u("asc"),S=V(()=>{const e=[];return n.value.Account!==""&&e.push("account like ?"),n.value.Displayname!==""&&e.push("display_name like ?"),p.value.length>0&&e.push("ou_id = ?"),e}),R=V(()=>{const e=[];return n.value.Account!==""&&e.push(`%${n.value.Account}%`),n.value.Displayname!==""&&e.push(`%${n.value.Displayname}%`),p.value.length>0&&e.push(p.value[0]),e}),{data:W,run:T,refresh:Y,loading:Z,total:ee,current:A,pageSize:z}=he($e,{defaultParams:{page:1,pageSize:10,sortField:"Id",sortOrder:"asc",filters:S,args:R},pagination:{currentKey:"page",pageSizeKey:"pageSize"}}),te={displayname:"display_name",lockoutenabled:"lockout_enabled"},ae=V(()=>({total:ee.value,current:A.value,pageSize:z.value})),E=()=>{setTimeout(()=>{Y()},50)},oe=(e,l)=>{y.value=l.node.dataRef,T({filters:S,args:R}),console.log("selected node",y.value)},ne=()=>{console.log("searchModel",n.value),setTimeout(()=>{T({page:A.value,pageSize:z.value,sortField:O.value,sortOrder:I.value,filters:S,args:R})},500)},le=()=>{n.value={Account:"",Displayname:""},i.value.resetFields(),E()},k=u(!1),D=u(),M=u(),se=e=>{D.value=e,k.value=!0},re=e=>{Le(e),E()},B=u(!1),ue=u(""),de=e=>d(this,null,function*(){Ge(e).then(l=>{De.warning({title:"Password only show once",content:v("div",{},[v("p",{},`user ${e} password resetted to`),v(Ce,{color:"red"},`${l}`)]),onOk(){E()}})})}),ie=()=>d(this,null,function*(){try{if(!(yield M.value.validate()))return}catch(e){console.log("error submit:",e);return}console.log("row",D.value),Me(D.value),k.value=!1,E()}),ce=()=>{M.value.resetForm(),k.value=!1},pe=()=>d(this,null,function*(){const e=yield Ne();D.value={id:e.id,ou:y.value.text,ouid:y.value.id},k.value=!0}),me=(e,l,h)=>{if(A.value=e.current,z.value=e.pageSize,h.field){const w=te[h.field];O.value=w!=null?w:h.field,I.value=h.order}else O.value="Id",I.value="asc";console.log("filter",S),T({page:A.value,pageSize:z.value,sortField:O.value,sortOrder:I.value,filters:S,args:R})};return(e,l)=>{const h=s("a-tree"),w=s("a-col"),ve=s("a-page-header"),q=s("a-input"),L=s("a-form-item"),U=s("a-button"),H=s("a-divider"),fe=s("a-form"),G=s("a-tooltip"),J=s("a-popconfirm"),ye=s("a-space"),X=s("a-switch"),_e=s("a-table"),j=s("a-modal"),ge=s("a-tag"),ke=s("a-row");return F(),K(ke,{gutter:16,style:{height:"400px","margin-bottom":"5px"}},{default:a(()=>[t(w,{span:4},{default:a(()=>[t(h,{ref_key:"orgTree",ref:P,expandedKeys:f.value,"onUpdate:expandedKeys":l[0]||(l[0]=r=>f.value=r),selectedKeys:p.value,"onUpdate:selectedKeys":l[1]||(l[1]=r=>p.value=r),"field-names":$,"tree-data":g.value,style:{height:"400px","margin-bottom":"5px"},onSelect:oe},null,8,["expandedKeys","selectedKeys","tree-data"])]),_:1}),t(w,{span:16},{default:a(()=>[t(ve,{style:{border:"1px solid rgb(235 237 240)"},"sub-title":"User list page",title:"Users"}),t(fe,{ref_key:"searchForm",ref:i,model:n.value,layout:"inline"},{default:a(()=>[t(L,{label:"Account"},{default:a(()=>[t(q,{value:n.value.Account,"onUpdate:value":l[2]||(l[2]=r=>n.value.Account=r),placeholder:"Account"},null,8,["value"])]),_:1}),t(L,{label:"Displayname"},{default:a(()=>[t(q,{value:n.value.Displayname,"onUpdate:value":l[3]||(l[3]=r=>n.value.Displayname=r),placeholder:"Displayname"},null,8,["value"])]),_:1}),t(L,null,{default:a(()=>[t(U,{type:"primary",onClick:ne},{icon:a(()=>[t(c(xe))]),default:a(()=>[m(" Search ")]),_:1}),t(U,{icon:v(c(Q)),type:"primary",onClick:le},{default:a(()=>[m(" Reset ")]),_:1},8,["icon"]),t(H,{type:"vertical"}),t(U,{icon:v(c(we)),type:"primary",onClick:pe},{default:a(()=>[m(" New ")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),t(H,{type:"horizontal"}),t(_e,{columns:b,"data-source":c(W)?c(W).list:null,loading:c(Z),pagination:ae.value,run:c(T),onChange:me},{bodyCell:a(({column:r,record:_})=>[r.key==="action"?(F(),K(ye,{key:0},{default:a(()=>[t(G,null,{title:a(()=>[m(" Edit")]),default:a(()=>[t(U,{icon:v(c(be)),type:"primary",onClick:x=>se(_)},null,8,["icon","onClick"])]),_:2},1024),t(G,null,{title:a(()=>[m("Delete")]),default:a(()=>[t(J,{placement:"right",title:"Delete User",onConfirm:x=>re(_.id)},{default:a(()=>[t(U,{icon:v(c(Se)),danger:""},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024),t(G,null,{title:a(()=>[m("Reset Password")]),default:a(()=>[t(J,{placement:"right",title:"Reset Password",onConfirm:x=>de(_.account)},{default:a(()=>[t(U,{icon:v(c(Q)),danger:""},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)):r.key==="lockoutenabled"?(F(),K(X,{key:1,checked:_.lockoutenabled,"onUpdate:checked":x=>_.lockoutenabled=x,size:"small"},null,8,["checked","onUpdate:checked"])):r.key==="istemporarypassword"?(F(),K(X,{key:2,checked:_.istemporarypassword,"onUpdate:checked":x=>_.istemporarypassword=x,size:"small"},null,8,["checked","onUpdate:checked"])):Re("",!0)]),_:1},8,["data-source","loading","pagination","run"]),t(j,{open:k.value,"onUpdate:open":l[4]||(l[4]=r=>k.value=r),title:"Edit User Info",onCancel:ce,onOk:ie},{default:a(()=>[t(Pe,{ref_key:"modalForm",ref:M,"form-model":D.value,"org-tree-data":g.value},null,8,["form-model","org-tree-data"])]),_:1},8,["open"]),t(j,{open:B.value,"onUpdate:open":l[5]||(l[5]=r=>B.value=r),title:"New Password"},{default:a(()=>[m(" User password is resetted to: "),t(ge,{color:"red"},{default:a(()=>[m(Te(ue.value),1)]),_:1})]),_:1},8,["open"])]),_:1})]),_:1})}}});export{Xe as default};
